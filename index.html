<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Zodiac builder</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <style>
        :root {
            /*PLACEMENT*/
            --top-initial: 100px;
            --top-final: 28px;
            --left-initial: 20px;
            --left-final: 100px;
            /*SIZES*/
            --primary-circle-width: 80px;
            --primary-circle-height: 80px;
            --secondary-circle-width: 40px;
            --secondary-circle-height: 40px;
            --inner-circle-width: 80%;
            --inner-circle-height: 80%;
            --stroke-width: 8px;
            --descender-length: 50px;
            /*COLORS*/
            --main-element-color: black;
            --main-background-color: #00FFCC;
            /*TIMING*/
            --interval: 1s;
        }
        
        body {
            background-color: var(--main-background-color);
        }
        
        #box {
            position: relative;
            margin: auto;
            display: block;
            background: var(--main-background-color);
            width: 250px;
            height: 250px;
            border: 1px solid var(--main-element-color);
        }
        
        .circle {
            display: grid;
            position: absolute;
            top: 150px;
            left: 20px;
            width: var(--primary-circle-width);
            height: var(--primary-circle-height);
            background-color: var(--main-element-color);
            -webkit-clip-path: circle(50% at 50% 50%);
            clip-path: circle(50% at 50% 50%);
        }
        
        .triangle {
            display: grid;
            position: absolute;
            top: 150px;
            left: 150px;
            width: var(--primary-circle-width);
            height: var(--primary-circle-height);
            background-color: var(--main-element-color);
            -webkit-clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
        }
        
        .bar {
            position: absolute;
            width: var(--stroke-width);
            height: var(--stroke-width);
            background-color: var(--main-element-color);
            z-index: 100;
            animation-duration: var(--interval);
            animation-name: fadeIn;
            animation-fill-mode: forwards;
        }
        
        .inner-circle {
            background-color: var(--main-background-color);
            margin: auto;
            display: block;
            -webkit-clip-path: circle(50% at 50% 50%);
            clip-path: circle(50% at 50% 50%);
            animation-duration: var(--interval);
            animation-name: growInnerCircle;
            animation-fill-mode: forwards;
        }
        
        .mask {
            position: absolute;
            background-color: var(--main-background-color);
            animation-duration: var(--interval);
            animation-name: fadeIn;
            animation-fill-mode: forwards;
        }
        
        .slide-vertical {
            animation-duration: var(--interval);
            animation-name: slideShapeVertical;
            animation-fill-mode: forwards;
        }
        
        .slide-horizontal {
            animation-duration: var(--interval);
            animation-name: slideShapeHorizontal;
            animation-fill-mode: forwards;
        }
        
        .rotate-ninety {
            animation-duration: var(--interval);
            animation-name: rotateNinetyClockwise;
            animation-fill-mode: forwards;
        }
        
        .shrink-circle {
            animation-duration: var(--interval);
            animation-name: shrinkCircle;
            animation-fill-mode: forwards;
        }
        
        .grow-descender {
            animation-duration: var(--interval);
            animation-name: growDescender;
            animation-fill-mode: forwards;
        }
        
        .not-rotated {
            -ms-transform: rotate(0deg);
            /* IE 9 */
            -webkit-transform: rotate(0deg);
            /* Safari */
            transform: rotate(0deg);
            /* Standard syntax */
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        @keyframes shrinkCircle {
            from {
                width: var(--primary-circle-width);
                height: var(--primary-circle-height);
            }
            to {
                width: var(--secondary-circle-width);
                height: var(--secondary-circle-height);
            }
        }
        
        @keyframes growInnerCircle {
            from {
                width: 0%;
                height: 0%
            }
            to {
                width: var(--inner-circle-width);
                height: var(--inner-circle-height);
            }
        }
        
        @keyframes growInnerCircleSmall {
            from {
                width: 0%;
                height: 0%
            }
            to {
                width: 50%;
                height: 50%;
            }
        }
        
        @keyframes growDescender {
            from {
                height: 0px;
            }
            to {
                height: var(--descender-length);
            }
        }
        
        @keyframes slideShapeVertical {
            from {
                top: var(--top-initial);
            }
            to {
                top: var(--top-final);
            }
        }
        
        @keyframes slideShapeHorizontal {
            from {
                left: var(--left-initial);
            }
            to {
                left: var(--left-final);
            }
        }
        
        @keyframes rotateNinetyClockwise {
            from {}
            to {
                -ms-transform: rotate(-90deg);
                /* IE 9 */
                -webkit-transform: rotate(-90deg);
                /* Safari */
                transform: rotate(-90deg);
                /* Standard syntax */
            }
        }

    </style>





</head>

<body>

    <!-- invisible box -->
    <div id=box>



        <div class="circle" onclick="aries(this)"></div>

        <div class="triangle" onclick="acquarius(this)"></div>


    </div>
    <!-- end invisible box -->



    <script type="application/javascript">
        //
        //Get the animation interval from CSS, convert to an integer in milliseconds
        var animationInterval = window.getComputedStyle(document.documentElement).getPropertyValue('--interval');
        animationInterval = parseInt(animationInterval.slice(0, -1)) * 1000;

        //Get the stroke width from CSS, convert to an integer
        var strokeWidth = window.getComputedStyle(document.documentElement).getPropertyValue('--stroke-width');
        strokeWidth = parseInt(strokeWidth.slice(0, -2));

        // TAURUS
        const taurus = (elem) => {
            emptyOutCircle(elem);
            var topCircle = divideCellVertical(elem, -8)
            setTimeout(function() {
                maskPartOfCircle(topCircle, "top", 60);
            }, animationInterval);
        }

        const acquarius = (elem) => {
            
            var secondTriangle;
            var thirdTriangle;
            
            secondTriangle = splitCellHorizontal(elem, strokeWidth * (-1)); 

            setTimeout(function() {
                thirdTriangle = splitCellHorizontal(elem, getWidth(elem) + strokeWidth * (-1));
            }, animationInterval);
        }

        // ARIES
        const aries = (elem) => {

            shrinkCircle(elem);

            var secondCircle;
            setTimeout(function() {
                secondCircle = splitCellHorizontal(elem, -8);
            }, animationInterval);

            setTimeout(function() {
                emptyOutCircle(elem);
                emptyOutCircle(secondCircle);
            }, animationInterval * 2);

            setTimeout(function() {
                maskPartOfCircle(elem, 'bottom', 50);
                maskPartOfCircle(secondCircle, 'bottom', 50);
            }, animationInterval * 3);

            setTimeout(function() {
                addCircleDescender(elem, 50);
            }, animationInterval * 4);
        }

        // GEMINI
        function gemini(originalCircle) {

            var gapBetweenCircles = 35;

            emptyOutCircle(originalCircle);
            var topCircle = divideCellVertical(originalCircle, gapBetweenCircles);

            setTimeout(function() {
                maskPartOfCircle(topCircle, 'top', 70);
            }, animationInterval);

            setTimeout(function() {
                maskPartOfCircle(originalCircle, 'bottom', 70);
            }, animationInterval);

            setTimeout(function() {
                var bar1 = createBar(gapBetweenCircles * 1.4, "vertical");
                positionElement(bar1, getBottomDistance(topCircle) - 8, getLeftDistance(originalCircle) + getWidth(originalCircle) * 0.3);
                originalCircle.parentElement.appendChild(bar1);

                var bar2 = createBar(gapBetweenCircles * 1.4, "vertical");
                positionElement(bar2, getBottomDistance(topCircle) - 8, getLeftDistance(originalCircle) + getWidth(originalCircle) * 0.6);
                originalCircle.parentElement.appendChild(bar2);
            }, animationInterval * 2);

        }


        // PISCES
        function pisces(elem) {

            var gap = 20;

            var invisibleBox = document.getElementById("box");

            emptyOutCircle(elem);
            var topCircle = divideCellVertical(elem, gap)

            setTimeout(function() {
                maskPartOfCircle(topCircle, "top", 50);
            }, animationInterval);

            setTimeout(function() {
                maskPartOfCircle(elem, 'bottom', 50);
            }, animationInterval);

            setTimeout(function() {
                var crossBar = createBar(getWidth(elem) + gap, "vertical");
                var leftDistance = getLeftDistance(elem) + getWidth(elem) / 2 - 4;
                var topDistance = getTopDistance(elem) - getWidth(elem) / 2 - gap;
                positionElement(crossBar, topDistance, leftDistance);
                invisibleBox.appendChild(crossBar);
            }, animationInterval * 2);

            setTimeout(function() {
                rotateElem(invisibleBox);
            }, animationInterval * 3);
        }


        function rotateElem(elem) {

            elem.classList.add("rotate-ninety");


        }

        const shrinkCircle = (elem) => elem.classList.add('shrink-circle');


        const resizeElement = (elem, amount) => {

            var style = window.getComputedStyle(elem, null);

            //Get style values of the element (minus 'px');
            var elemWidth = parseInt(style.width.slice(0, -2));
            var elemHeight = parseInt(style.height.slice(0, -2));

            elem.style.height = elemHeight * amount + "px";
            elem.style.width = elemWidth * amount + "px";

        }


        const addCircleDescender = (elem, length) => {

            var descenderBar = createBar(length, "vertical");

            var verticalPosition = getTopDistance(elem) + (getHeight(elem) / 2);
            var leftPosition = getLeftDistance(elem) + getWidth(elem) - strokeWidth;

            positionElement(descenderBar, verticalPosition, leftPosition);

            descenderBar.classList.add('grow-descender');

            elem.parentElement.appendChild(descenderBar);

            console.log(descenderBar);
        }


        function emptyOutCircle(element) {

            var elem = element;
            var style = window.getComputedStyle(elem, null);

            //Get style values of the element (minus 'px');
            var elemWidth = parseInt(style.width.slice(0, -2));
            var elemHeight = parseInt(style.height.slice(0, -2));

            //Set the inner circle width and height
            //Minus 2*stroke width (8)
            let root = document.documentElement;
            root.style.setProperty('--inner-circle-width', elemWidth - 16 + "px");
            root.style.setProperty('--inner-circle-height', elemWidth - 16 + "px");



            //Create new circle, add to parent
            var innerCircle = document.createElement('div');
            innerCircle.setAttribute("class", "inner-circle");
            elem.appendChild(innerCircle);
        }


        function maskPartOfCircle(element, side, percentToMask) {

            //Get dimensions and placement of object to mask
            var elemWidth = getWidth(element);
            var elemHeight = getHeight(element);
            var elemLeftValue = getLeftDistance(element);
            var elemTopValue = getTopDistance(element);

            //Create mask
            var mask = document.createElement('div');
            mask.setAttribute("class", "mask");

            //Mask either top or bottom 
            switch (side) {
                case ("top"):
                    mask.style.width = elemWidth + "px";
                    mask.style.top = elemTopValue + "px";
                    mask.style.left = elemLeftValue + "px";
                    mask.style.height = elemHeight * (percentToMask / 100) + "px";
                    break;
                case ("bottom"):
                    mask.style.width = elemWidth + "px";
                    mask.style.top = elemTopValue + (elemHeight * ((100 - percentToMask) / 100)) + "px";
                    mask.style.left = elemLeftValue + "px";
                    mask.style.height = elemHeight * (percentToMask / 100) + "px";
                    break;

                default:
                    console.log("Please enter top, bottom, left or right");

            }

            element.parentElement.appendChild(mask);
        }


        function createBar(size, orientation) {

            var crossBar = document.createElement("div");
            crossBar.classList.add('bar');

            if (orientation == "vertical") {
                crossBar.style.height = size + "px";
            } else if (orientation == "horizontal") {
                crossBar.style.width = +"px";
            } else {
                console.log("Please enter vertical or horizontal");
            }
            return crossBar;
        }

        function positionElement(element, top, left) {
            element.style.top = top + "px";
            element.style.left = left + "px";
        }


        const splitCellHorizontal = (elem, gap) => {

            console.log('splitting');



            var style = window.getComputedStyle(elem, null);
            var dupNode = elem.cloneNode(true);

            //Get style values of the element (minus 'px');
            var elemLeftValue = parseInt(style.left.slice(0, -2));
            var elemWidth = parseInt(style.width.slice(0, -2));

            //we need to do this for now because the shrinking animation interferes with the splitting one.
            dupNode.style.width = style.width;
            dupNode.style.height = style.height;
            dupNode.classList.remove('shrink-circle');

            dupNode.classList.add("slide-horizontal");

            let root = document.documentElement;
            root.style.setProperty('--left-initial', style.left);
            root.style.setProperty('--left-final', elemLeftValue + elemWidth + gap + "px");
            document.getElementById('box').appendChild(dupNode);

            console.log(dupNode);

            return dupNode;
        }

        const divideCellVertical = (elem, gap) => {

            var style = window.getComputedStyle(elem, null);
            var dupNode = elem.cloneNode(true);
            let root = document.documentElement;

            //Get style values of the element (minus 'px');
            var elemTopValue = parseInt(style.top.slice(0, -2));
            var elemWidth = parseInt(style.width.slice(0, -2));

            dupNode.classList.add("slide-vertical");
            root.style.setProperty('--top-initial', elemTopValue + "px");
            root.style.setProperty('--top-final', elemTopValue - elemWidth - gap + "px");
            document.getElementById('box').appendChild(dupNode);
            return dupNode;
        }




        function getWidth(elem) {
            var style = window.getComputedStyle(elem, null);
            // Return pixel width of element as an integer, removing "px"
            return parseInt(style.width.slice(0, -2));
        }

        function getHeight(elem) {
            var style = window.getComputedStyle(elem, null);
            // Return pixel height of element as an integer, removing "px"
            return parseInt(style.height.slice(0, -2));
        }

        function getLeftDistance(elem) {
            var style = window.getComputedStyle(elem, null);
            // Return left value of element as an integer, removing "px"
            return parseInt(style.left.slice(0, -2));
        }

        function getTopDistance(elem) {
            var style = window.getComputedStyle(elem, null);
            // Return top Value of element as an integer, removing "px"
            return parseInt(style.top.slice(0, -2));
        }

        function getBottomDistance(elem) {
            var style = window.getComputedStyle(elem, null);
            var top = parseInt(style.top.slice(0, -2));
            return top + getHeight(elem);
        }

    </script>






</body>

</html>
